{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
    <h1>{{ post.title }}</h1>
    <p>{{ post.description }}</p>
    <p>By {{ post.author.display_name }} on {{ post.published|date:"F j, Y, g:i a" }}</p>
    <div class="post-content">
        {{ post.text_content|linebreaks }}
    </div>

    {% if author and author.id == post.author.id %}
        <a href="{% url 'edit_post' post.id %}">Edit Post</a>
        <form action="{% url 'delete_post' post.id %}" method="POST" style="display:inline;">
            {% csrf_token %}
            <button type="submit" onclick="return confirm('Are you sure you want to delete this post?');">Delete Post</button>
        </form>
    {% endif %} 

    <!-- Display Likes -->
    <p>Likes: {{ likes.count }}</p>

    <!--    Display Edit if rightful owner-->
    {% if is_author %}
        <a href="{% url 'edit_post' post.id %}" class="edit-button">Edit Post</a>
    {% endif %}

    <form action="/node/posts/{{ id }}/like/" method="POST">
        {% csrf_token %}
        {% if liked %}
        <button type="submit">Unlike</button>
        {% else %}
        <button type="submit">Like</button>
        {% endif %}
    </form>

    <!-- Repost Button -->
    <form action="/node/posts/{{ id }}/repost/" method="POST">
        {% csrf_token %}
        <button type="submit" id="repost">Repost</button>
    </form>

    <!-- Comments Section -->
    <h2>Comments</h2>
    {% if comments %}
        <ul class="comment-list">
            {% for comment in comments %}
                <li>
                    <p>{{ comment.author.display_name }} said on {{ comment.published|date:"F j, Y, g:i a" }}</p>
                    <p>{{ comment.text }}</p>
                    <form action="/node/posts/{{ comment.id }}/likecomment/" method="POST">
                        {% csrf_token %}
                        {% if comment.liked %}
                        <button type="submit">Unlike</button>
                        {% else %}
                        <button type="submit">Like</button>
                        {% endif %}
                    </form>
                    <p>Likes: {{ comment.likes }}</p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No comments yet.</p>
    {% endif %}

    <!-- Comment Form -->
    <h3>Add Comment</h3>
    <form action="/node/posts/{{ id }}/add_comment/" method="POST">
        <label style="font-weight: bold;">Text</label><br>
        <textarea name="content" style="min-width: 400px; max-width: 400px;"></textarea><br><br>
        <input type="submit" />
        {% csrf_token %}
    </form>
{% endblock %}
